machine:
  environment:
    NODE_ENV: circle
  node: 
    version: 6.6.0

dependencies: 
  cache_directories:
    - mongodb-linux-x86_64-ubuntu1204-3.2.3
  pre:
    - if [[ ! -d mongodb-linux-x86_64-ubuntu1204-3.2.3 ]]; then wget http://fastdl.mongodb.org/linux/mongodb-linux-x86_64-ubuntu1204-3.2.3.tgz && tar xvzf mongodb-linux-x86_64-ubuntu1204-3.2.3.tgz; fi
    - sudo stop mongod
    - sudo cp mongodb-linux-x86_64-ubuntu1204-3.2.3/bin/* /usr/bin
    - sudo start mongod
    - sudo pip install --upgrade pip
    - sudo pip install python-dev
    - sudo -H pip install 'awsebcli==3.7.4'

database:
  override:
    - mongo < /home/ubuntu/wordnik-api-lb/test/database/loadData.js    

deployment:
  development:
    branch: development
    commands:
      - snyk auth $SNYK_TOKEN
      - snyk monitor
      - bash ./setup-eb.sh
      - eb init 'nodenik-api' -r us-west-1 -p node.js
      - eb deploy nodenikApi-private-dev --profile EB-deployer --debug
